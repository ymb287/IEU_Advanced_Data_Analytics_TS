---
title: "Advanced Data Analytics"
author:
  - Loukas Gonzalez
  - Simon Alvarez Bliffeld
  - Simon Gonzalez
  - Yannik Biebert
date: "2023-11-28"
output:      
  rmarkdown::html_document:
    theme: cosmo
    highlight: tango
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: true
---

```{r setup, include=FALSE}
# Set up: do not change!!!
knitr::opts_chunk$set(echo = TRUE)
```

<br>

------------------------------------------------------------------------

<br>

For the final project of Advanced Data Analytics, we decided to analyze three variables of two different countries, and with them, find and dissect valuable information, with which we can create forecasts. The two countries that we decided on were Italy and the US. These countries, with their diverse economic landscapes, wield significant global influence, and despite their distinct economic landscapes, share a profound impact on the global stage. 
The variables that we will be using will be the following: GDP, CPI, and Stock Market Index. GDP, measuring a nation's total economic output, serves as a primary focus. An increase in GDP signifies economic growth, leading to job creation and higher incomes. Conversely, a decrease in GDP suggests a recession, bringing about unemployment and income reductions. The CPI, or Consumer Price Index, plays a pivotal role in understanding how prices for everyday goods and services are changing, offering insights into inflation and its impact on the cost of living. The Stock Market Index, another vital variable, tracks and represents the collective performance of selected stocks within each nation's equity market. Changes in the Stock Market Index are closely tied to the confidence in a country's economy, reflecting investor sentiment and overall economic conditions. We wanted to use these variables as it has been proven that they are correlated, with examples such as the “positive and significant relationship between the GDP and CPI” (Mahmoud, 2015). Our main goal for doing this project is to understand the economic health of each country, see how the variables relate to each other, and understand how we can predict the future, and we want to observe what these predictions are. This type of work is very important in the real world, as it can help policymakers understand the state of their country’s economy, and with this, advise them in creating measures that can stabilize it and overall aid the country.  


# Part 1: Prepare and inspect the data

-   Visual inspection of data and season, trend DONE, including desriptions

-   Stationarity testing DONE

-   Inspect autocorrelation with acf and pacf DONE

Steps for us:

-   Inspect volatility clustering (if so, maybe GARCH needed?) DONE

-   if it has season use holt-winters, DO WE NEED TBATS or STLM? Because I dont think whe have two cicles in each other # DONE

-   Look for ARIMA models (on data and on estimated ets()/msts()

-   Identify the regular component by exploring the ACF and PACF of the residuals of the seasonal model.

-   Compare models (including ets models)- AIC or Accuracy Metrics

-   Choose best model and visualize, look at residuals, maybe GARCH (or should be aready dicide this before using ARIMA Model and use it directly?)

-   Use maybe Garch, and compare those models

-   Summary of findings

-   Forcast and plot final model

-   conclusion of forecast

------------------------------------------------------------------------

## 1.1 Importing and inspecting the data set

```{r Import data, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# import packages
library(pacman)
p_load(
  readxl, tseries, tidyverse, dplyr, tidyr, forecast, fpp2, stats, quantmod, zoo, lubridate, ggplot2, cowplot, rugarch
)

# import data set xlxs
data <- read_excel("Datasets.xlsx")

# removing not used columns Housing and Unemployment
data <- data[, -c(7, 9)]


# Display the data set
print(data)

```

As observed, the years that we will be using for this analysis are from 2000 to 2020, giving us a comprehensive analysis of each country's variables throughout the 21st century.

## 1.2 Prepare the data

```{r transform data, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
# Split the data into two dataframes based on the country
data_italy <- subset(data, Country %in% c("Italy"))
data_usa <- subset(data, Country %in% c("USA"))

# Function for data transformation
transform_data <- function(df) {
  # Extract columns from the dataframe
  gdp <- df$'GDP, billion currency units'
  cpi <- df$'Consumer Price Index (CPI)'
  stocks <- df$'Stock market index'

  # Drop missing values (becuase only every quarter)
  gdp <- na.omit(gdp)

  # Drop missing values (becuase last in the month)
  cpi <- na.omit(cpi)
  stocks <- na.omit(stocks)

  # Change to time series
  gdp <- ts(gdp, start = c(2000, 1), frequency = 4)
  cpi <- ts(cpi, start = c(2000, 1), frequency = 12)
  stocks <- ts(stocks, start = c(2000, 1), frequency = 12)
  
  # Drop everything after 2019
  gdp <- window(gdp, end = c(2019, 4))
  cpi <- window(cpi, end = c(2019, 12))
  stocks <- window(stocks, end = c(2019, 12))
  
  # Return the time series as separate variables
  return(list(gdp = gdp, cpi = cpi, stocks = stocks))
}

# Apply the transformation function
transformed_italy  <- transform_data(data_italy)
transformed_usa <- transform_data(data_usa)

```

After analyzing the data, we decided to omit the information from 2020 onwards. The Covid pandemic in 2020 significantly disrupted global economic patterns, causing unprecedented fluctuations in GDP, CPI, and Stock Market Indices. The widespread lockdowns, supply chain disruptions, and shifts in consumer behavior during the pandemic created outliers in the data that could skew our analysis and adversely affect the accuracy of our forecasts.

## 1.3 Visual inspection of the data, including Seasonality

### 1.3.1 GDP Italy

```{r plot gdp in italy, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Create a function for visualization.
plot_and_zoom <- function(data, variable, country,num_years) {
  
  # Extract the specified number of years from the time series
  end_date <- start(data) + c(num_years, 0)
  window_data <- window(data, start = start(data), end = end_date)
  
  # Create the main plot
  main_plot <- ggplot(data, aes(x = time(data), y = as.numeric(data))) +
    geom_line() +
    theme_minimal() +
    labs(title = paste0(variable, ' in ', country), x = "Year", y = variable) +
    theme(panel.grid.minor = element_blank(),
      plot.title = element_text(size = 12, face = "bold", hjust = 0.5))
  
  # Create a zoomed-in version with the specified number of years
  zoomed_in_plot <- ggplot(window_data, aes(x = time(window_data), y = as.numeric(window_data))) +
    geom_line() +
    labs(title = paste0('Zoomed in ',variable, ' in ', country), x = "Year", y = variable) +
    theme_minimal() +
    theme(panel.grid.minor = element_blank(),
      plot.title = element_text(size = 12, face = "bold", hjust = 0.5))
  
  plot_grid(main_plot, zoomed_in_plot, ncol = 1)
  
}

# Plot the GDP for Italy
plot_and_zoom(transformed_italy$gdp, 'GDP', 'Italy', 4)

```

PRESENTATIONHERE

We can make some observations by looking at the graph of Italy's GDP from 2000 - 2020. The GDP shows a clear upward trend, with a sharper increase from 2000 to 2008, where it stabilizes, and again an increase from 2015-2020. The interruption in the trend corresponds to the 2008 financial crisis, which shook the economy and its growth. We can also note a seasonality throughout the time series. Italy's economy after 2001 began to slow down, even though the GDP is seen to be growing, the rate of growth had decreased. Factors such as "aging population, inflation, stagnation, and the impact of globalization on trade and demand" heavily affected the country's development and economic growth (Ardeni & Gallegati, 2023). Italy's development is slow mainly when compared to other countries European countries with similar capabilities and factors. We can observe another factor in the zoomed version of Italy's GDP. The plot shows a clear trend or pattern of seasonality, wherein in the first part of the year we observe a slight increase in the GDP, followed by a sharper increase in the second part of the year, and this is observed in all of the years included. This could be attributed to factors such as traditional vacation patterns, tourism peaks, or specific industry behaviors.

### 1.3.2 CPI Italy

```{r plot cpi in italy, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Plot the CPI for Italy
plot_and_zoom(transformed_italy$cpi, 'CPI', 'Italy', 4)


```

Italy's CPI has seen a similar path to the GDP. From 2000 onwards, Italy's Consumer Price Index (CPI) has undergone fluctuations influenced by various economic factors. In the early 2000s, the CPI experienced constant growth, which continued until 2012, when it began to slow down and reduce the growth rate. This might be the consequence on the financial crisis, combined with internal economic and political issues. The zoomed plot also reveals seasonality, as we can observe dips in the CPI in the first part of each year for all of the observed periods. This could be attributed to high spending seasons of the year, as it usually is found in most CPI plots, such as holidays.

### 1.3.3 Stock Italy

```{r plot stocks in italy, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Plot stocks for Italy
plot_and_zoom(transformed_italy$stocks, 'Stocks', 'Italy', 4)

```

The Stock Market Index for Italy is very different from the previous charts and datasets. As observed, the market had many fluctuations throughout the 2000 - 2020 period. We can observe that from 2000 to 2003, Italy's stock market had a steep decline, followed by a rapid growth period that was again stopped by the financial crisis of 2008-2009. The index maintained high volatility for the following period, with short periods of growth or decline, but with an overall positive growth trend. Again, most of the behavior of the market is related to political decisions that the Italian government has made and external economic factors influencing investor confidence. Notably, the stock market showed increased volatility during times of political unpredictability or changes in governmental policy. Furthermore, the overall state of the world economy, particularly the Eurozone crisis, had a big impact on how the Italian stock market developed (Codogno & Galli, 2022).

### 1.3.4 GDP USA

```{r plot gdp in usa, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Plot GDP for USA
plot_and_zoom(transformed_usa$gdp, 'GDP', 'USA', 4)

```

In the United States GDP time series, we again observe a positive trend, with periods of faster increase. There is a specific moment where we see an interruption in the growth, which is in 2008, corresponding to the Financial Crisis. After this period, we can observe that the GDP grew at a faster rate. Aiming to revive the economy, major government interventions, fiscal stimulus packages, and monetary policies are responsible for these accelerations in GDP growth in the post-crisis decades. The United States has gained more and more power and importance globally, which again also influenced the constant growth of its GDP (Salvatore, 2020). No indications of seasonality or a specific pattern can be observed in the plot or the zoomed plot. Moreover, it can be observed that the GDP for USA is significantly higher than Italy's, mostly as a result of the US doing more business abroad and having a bigger economy. The USA's economy is stronger than Italy's due in part to their larger corporations, advancements in technology, and international trading practices.

### 1.3.5 CPI USA

```{r plot cpi in usa, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Plot CPI for USA
plot_and_zoom(transformed_usa$cpi, 'CPI', 'USA', 4)

```

The USA's CPI follows a very positive trend, with continuous growth throughout the period observed. We can observe certain moments of slowdown, specifically after the 2008 financial crisis, but even with this, the CPI is constantly growing, at a somewhat slow rate. No seasonality or specific pattern can be observed in the plot or the zoomed plot. This upward trend points to an economy that is typically growing and stable, with rare setbacks like the financial crisis eventually being resolved. These variations in the growth rate could also be a sign of the economy's resiliency and capacity to bounce back from setbacks, which would explain the CPI's general upward tendency.

### 1.3.6 Stocks USA

```{r plot stocks in usa, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Plot stocks for USA
plot_and_zoom(transformed_usa$stocks, 'Stocks', 'USA', 4)

```

The Stock Market index for the USA different from what we observed in Italy, shows a clear upward trend, with some periods of higher volatility and shifts. Again, as noted in all of the previous plots, we see a period of decline right in 2008, which corresponds to the financial crisis, where gains were lost in a very short period. The U.S. stock market proved strong after this trying time, rising and showing a steady growth trend, confirming the economy's capacity to come back from difficult periods. The U.S. financial system's inherent flexibility and the proactive actions of policymakers are frequently credited for this recovery.

## 1.4 Train test split

```{r train test split alternative, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
# Function for train test split
train_test_split <- function(data_list, train_percentage = 0.8) {
  split_data <- list()
  
  # Loop through the variables in the list
  for (variable in names(data_list)) {
    ts_data <- data_list[[variable]]
    data_length <- length(ts_data)

    # Calculate the train size
    train_size <- round(train_percentage * data_length)
    
    # Train split, this way needed, to keep the ts format
    train_data <- ts(ts_data[1:train_size], start = start(ts_data), frequency = frequency(ts_data))

    end_time <- time(train_data)[length(train_data)]
    
    # Get start for testdata, if only split with [:] the ts type is lost as well as the start time
    if (frequency(ts_data) == 12) {
      end_time <- end_time + 1/12
      start_year <- floor(end_time)
      start_month <- (end_time - start_year) * 12 + 1
    } else if (frequency(ts_data) == 4) {
      end_time <- end_time + 1/4
      start_year <- floor(end_time)
      start_month <- (end_time - start_year) * 4 + 1
    } else {
      print('Error: Frequency not supported')
    }

    test_data <- ts(ts_data[(train_size + 1):data_length], start = c(start_year, start_month), frequency = frequency(ts_data))
    
    # Add the data to the list
    split_data[[paste0(variable, "_train")]] <- train_data
    split_data[[paste0(variable, "_test")]] <- test_data
  }

  return(split_data)
}

# Apply the train test split function
split_italy <- train_test_split(transformed_italy)
split_usa <- train_test_split(transformed_usa)

```

Splitting the data into a train and a test part is important to evaluate the models. By only splitting with [:] the ts type is lost as well as the start time. Therefore the function above is needed.

```{r extract data, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Italy variables
gdp_italy_train <- split_italy$gdp_train
gdp_italy_test <- split_italy$gdp_test

cpi_italy_train <- split_italy$cpi_train
cpi_italy_test <- split_italy$cpi_test

stocks_italy_train <- split_italy$stocks_train
stocks_italy_test <- split_italy$stocks_test

# USA variables
gdp_usa_train <- split_usa$gdp_train
gdp_usa_test <- split_usa$gdp_test

cpi_usa_train <- split_usa$cpi_train
cpi_usa_test <- split_usa$cpi_test

stocks_usa_train <- split_usa$stocks_train
stocks_usa_test <- split_usa$stocks_test

```

The different variables are extracted from the list. Those variables are used for the model fitting.

## 1.5 Evaluate the data from Italy

### 1.5.1 GDP Italy

```{r evaluate gdp in italy, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.width=8, fig.height=3}

# Analyse the different variables for stationarity
analyze_time_series <- function(ts_data, country, variable) {

  # Doing the ADF and PP test, as well as determining diff
  adf_result <- tseries::adf.test(ts_data)
  num_diffs <- ndiffs(ts_data)

  # Print results for the current variable
  cat("Results for", variable, "in", country, ":\n")
  cat("ADF Test:\n")
  cat("  P-Value:", adf_result$p.value, "\n")
  cat("Number of Differences Required for Stationarity:", num_diffs, "\n\n")
  
  # Set up the plot
  par(mfrow = c(1, 2), mar = c(3, 4, 4, 1))

  # ACF and PACF plots
  acf(ts_data, main = paste("ACF of", variable, "in", country))
  pacf(ts_data, main = paste("PACF of", variable, "in", country))
}

# Explore gdp of Italy
analyze_time_series(gdp_italy_train, "Italy", 'GDP')

```

PRESENTATIONHERE

In our financial analysis of Italy's GDP, the Autocorrelation Function (ACF) displayed over 15 significant lags, as well as the before seen seasonal pattern. Due to the slow decline we might conclude that it is an AR model. This is further supported due to the steep decline in the Partial Autocorrelation Function (PACF) after the fifth lag. Also the Model will probably include a seasonal component. Since is is quarterly and could already be seen in the plotted data. This might even reduce the PACF lags to 1. The Augmented Dickey-Fuller (ADF) test has a p-value of 0.83, which is more than 0.05, indicating that the data is non-stationary. The number of differences required for stationarity is 1.

```{r differenced gdp in italy, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Analyse the differenced variables for stationary
analyze_diff_series <- function(ts_data, country, variable, seasonal = 0) {
  
  # Getting number of differences required for stationarity
  num_diffs <- ndiffs(ts_data)
  
  # Differncing num_diffs times
  for (i in 1:num_diffs) {
    ts_data <- diff(ts_data)
  }
  
  if (seasonal != 0){
    ts_data <- diff(ts_data, lag = seasonal)
  }
  
  # Performing the ADF and PP test
  adf_result <- tseries::adf.test(ts_data)
  num_diffs_new <- ndiffs(ts_data)
  
  # Print results for the current variable
  cat("Results for", variable, "in", country, "with season", seasonal, ":\n")
  cat("ADF Test:\n")
  cat("  P-Value:", adf_result$p.value, "\n")
  cat("Number of Differences Required for Stationarity:", num_diffs_new, "\n\n")

}

# Difference data from Italy
analyze_diff_series(gdp_italy_train, "Italy", 'GDP')
analyze_diff_series(gdp_italy_train, "Italy", 'GDP', 4)

```

PRESENTATIONHERE

After using the recommended number of differences of 1 on Italy's GDP the Augmented Dickey-Fuller (ADF) test suggested marginal evidence against stationarity with a p-value of 0.062, as well as no further differencing. Since this is not completely stationary the 4th difference is take, because a seasonal component was detected in the ploted data as well as the ACF and PACF. In the seasonal scenario, the ADF test provided strong evidence for stationarity with a p-value of 0.01. This suggests to use one difference in the modeling part, as well as including a SMA.

### 1.5.2 CPI Italy

```{r evaluate cpi in italy, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.width=8, fig.height=3}

# Explore cpi of Italy
analyze_time_series(cpi_italy_train, "Italy", 'CPI')

```

For Italy's CPI the ADF has a p-value of 0.95 suggesting evidence against stationarity. Also it is recommended to difference once. The ACF shows a slow decline and since the PACF has a steep drop at lag 1, as well as violations as 7 and 13, the model will probably have a bit focus on the AR part.

```{r differenced cpi in italy, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Explore cpi of Italy
analyze_diff_series(cpi_italy_train, "Italy", 'CPI')

```

After using the recommended number of differences (1) on Italy's CPI the Augmented Dickey-Fuller (ADF) test suggested  stationarity, as well as no further differencing. But it can be seen that the value is still bigger then the other once before and taking the graphsF into account as well a seasonal component can be expected.

### 1.5.3 Stocks Italy

```{r evaluate stocks in italy, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.width=8, fig.height=3}

# Explore stocks of Italy
analyze_time_series(transformed_italy$stocks, "Italy", 'Stocks')


```

For Italy's stock data the ADF has a p-value of 0.41 suggesting nn-stationarity. Also it is recommended to difference once. The ACF shows a slow decline and since the PACF has a steep drop at lag 2, the model will probably be an AR(2). This will be tested in the modeling part.


```{r differenced stocks in italy, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Explore stocks of Italy
analyze_diff_series(stocks_italy_train, "Italy", 'Stocks')

```

After using the recommended number of differences (1) on Italy's stock data the Augmented Dickey-Fuller (ADF) test suggested stationarity, as well as no further differencing is recommended. 

### 1.5.4 GDP USA

```{r evaluate gdp in usa, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.width=8, fig.height=3}

# Explore gdp of USA
analyze_time_series(transformed_usa$gdp, "USA", 'GDP')

```

For USA GDP data the ADF test suggested with a p-value of 0.82 non-stationarity. Also taking one difference is recommended. The ACF shows a slow decline and since the PACF has a steep drop at lag 1, the model will probably be an AR(1). This will be tested in the modeling part.

```{r differenced gdp in usa, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Explore gdp of Italy
analyze_diff_series(gdp_usa_train, "USA", 'GDP')
analyze_diff_series(diff(gdp_usa_train), "USA", 'GDP')

```

After using the recommended number of differences (1) on USA GDP the Augmented Dickey-Fuller (ADF) test suggested evidence against stationarity with a p- value of 0.29, as well as no further differencing. Since this is not completely stationary it was differenced once more and then the ADF test provided strong evidence for stationarity. This suggests using one difference in the modeling part, and inlcuding a drift.

### 1.5.5 CPI USA

```{r evaluate cpi in usa, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.width=8, fig.height=3}

# Explore cpi of USA
analyze_time_series(cpi_usa_train, "USA", 'CPI')

```

For USA cpi data the ADF test has a p-value of 0. 0.89 suggesting non-stationarity. Also taking one difference is recommended. The ACF shows a slow decline and since the PACF has a steep drop at lag 1, the model will probably be an AR(1). This will be tested in the modeling part.

```{r differenced cpi in usa, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Explore cpi of Italy
analyze_diff_series(cpi_usa_train, "USA", 'CPI')

```

After using the recommended number of differences on USA cpi the Augmented Dickey-Fuller (ADF) test rejects the H0 hypothesis, and suggests stationary. This suggests using one difference in the modeling part.

### 1.5.6 Stocks USA


```{r evaluate stocks in usa, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.width=8, fig.height=3}

# Explore stocks of USA
analyze_time_series(stocks_usa_train, "USA", 'Stocks')

```

For USA stock data the Augmented Dickey-Fuller test has a p-value of 0.  0.41. The ACF shows a slow decline and  the PACF has a steep drop at lag 1 and a violation at lag 2.

```{r differenced stocks in usa, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Explore stocks of Italy
analyze_diff_series(stocks_usa_train, "USA", 'Stocks')

```

After using the recommended number of differences on USA stock the Augmented Dickey-Fuller test suggests stationarity. Also no further differencing is recommended.

## 1.6 Volatility clustering

```{r volatility clustering italy stocks, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.width=8, fig.height=3}

plot_volatility_clusters <- function(time_series, country, variable, uper = 0) {
  
  # Calculate the squared returns
  time_series <- diff(time_series)^2
  
  if (uper == 0) {
    uper <- max(time_series) + max(time_series)*0.05
  }

  # Create the line plot
  ggplot(data.frame(time = time(time_series), value = time_series), aes(x=time,y=value))  +
    geom_segment(aes(xend = time, yend = 0)) +
    labs(title = paste("Squared returns of", variable, 'in', country),
         x = "Time",
         y = "Squared returns") + 
    theme_minimal() +
    theme(panel.grid.minor = element_blank(),
      plot.title = element_text(size = 12, face = "bold", hjust = 0.5)) +
    scale_y_continuous(limits = c(0, uper))

}

# Plotting the volatility clustering 
plot_volatility_clusters(transformed_italy$stocks, 'Italy', 'Stocks')
```



The volatility clustering in Italy's stock data represents the larger volatility during the dot com bubble of 2002 and the 2007 housing crisis. As a result of the volatility, GARCH is used as the preferred model to capture the most information. Additionally, GARCH is most efficient at capturing time-varying volatility within financial data.

```{r volatility clustering usa stocks, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.width=8, fig.height=3}

# Plotting the volatility clustering
plot_volatility_clusters(transformed_usa$stocks, 'USA', 'Stocks', 50)

```
The volatility clustering of the US stock data highlights larger volatility during uncertain times such as the 2002 dot com bubble and 2007 housing crisis. As a result of the volatility, GARCH is used as the preferred model to capture the most information. Additionally, GARCH is most efficient at capturing time-varying volatility within financial data.


<br>

------------------------------------------------------------------------

<br>

# Part 2: Model

------------------------------------------------------------------------

After inspecting the data and evaluating the different tests and plots as well as gathering information about features of the time series the modeling part can be started. The modeling part will be split into multiple parts. Before starting with ARIMA models, the data are split and the trend and sesonality of seasonal data are further inspected using the winter-holt method. After that the ARIMA models are created and evaluated.
First, different ARIMA models are created, based on the insides gathered before, as well as using the auto.arima function. Second, the best model is chosen and the residuals are inspected. If the residuals are not white noise, further models are created. Finally the best model is chosen and the forecasts are created and evaluated.

## 2.1 Trend and Seasonality with winter-holt

```{r stationarity italy cpi, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}


plot_forecast <- function(train_data, test_data, ts_data, country, variable, alpha, model) {
  model_hw <- ets(train_data, model = model, alpha = alpha)
  ntest <- length(test_data)

  pred <- forecast(model_hw, h = ntest, level = 0)

  pred_hw <- c(model_hw$fitted, pred$mean)

  # Extract the last date of the training data
  last_date_train <- tail(time(train_data), 1)

  ggplot(data.frame(time = time(ts_data), value = ts_data, pred_hw = pred_hw)) + 
    geom_line(aes(x = time, y = value, group = 1)) +
    geom_line(aes(x = time, y = pred_hw, group = 1), color = "dodgerblue4", size = 0.75) +
    geom_vline(aes(xintercept = as.numeric(last_date_train)), color = "darkorange2", size = 0.9) +
    xlab("Year") +
    ylab(paste(variable, "in", country)) +
    labs(title = paste("Forecast for", variable, "in", country),
         subtitle = paste("Exponential Smoothing (ETS) with alpha =", alpha),
         caption = "Vertical line represents the last date of the training data") +
    theme_minimal() +
    theme(plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
          plot.subtitle = element_text(size = 10, hjust = 0.5),
          plot.caption = element_text(size = 6))
  
}

plot_forecast(gdp_italy_train, gdp_italy_test, transformed_italy$gdp, country = "Italy", variable = "GDP", alpha = 0.7, 'AAA')

```

PRESENTATIONHERE

TODO dsicription of the plot, the foreccast only with trend and season is good stron influence in general and little other infromation? No clue what else

```{r stationarity italy gdp, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

plot_forecast(cpi_italy_train, cpi_italy_test, transformed_italy$cpi, country = "Italy", variable = "CPI", alpha = 0.7, 'AAA')


```

TODO description of plot and what it means

## 2.2 ARIMA

### 2.2.1 GDP Italy

```{r modelling italy gdp, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
# Function to format ARIMA order
format_arima_order <- function(arma) {
  non_seasonal <- paste(arma[1], arma[6], arma[2])
  seasonal <- paste(arma[3], arma[7], arma[4])
  period <- arma[5]
  return(paste("ARIMA(", non_seasonal, ")", "(", seasonal, ")", "[", period, "]", sep = ""))
}

# Function for model comparison
evaluate_arima_models <- function(models, test_data) {
  
  results <- data.frame(Model = character(), AIC = numeric(), SIC = numeric(), BIC = numeric(), Residuals = character(), MSPE = numeric())
  
  for (model in models) {
    fit <- model
    order <- coef(fit)
    
    # Extract AIC and SIC
    aic <- AIC(fit)
    sic <- AIC(fit, k = log(length(fit$residuals)))
    bic <- BIC(fit)
    
    # Check residuals for white noise
    white_noise <- Box.test(fit$residuals, lag = 20, type = "Ljung-Box")$p.value > 0.05
    residuals_check <- ifelse(white_noise, "White Noise", "Not White Noise")
    
    # Make predictions on test data
    pred <- forecast(fit, h = length(test_data))
    
    # Calculate MSPE
    mspe <- mean(((pred$mean - test_data) / test_data)^2, na.rm = TRUE)*100


    # Append results to the data frame
    name <- format_arima_order(model$arma)
    result_row <- data.frame(Model = name, AIC = aic, SIC = sic, BIC = bic, Residuals = residuals_check, MSPE = mspe)
    results <- rbind(results, result_row)
  }

  return(results)
}


# Crate different models
model_max_i_gdp <- forecast::Arima(gdp_italy_train, order = c(9, 1, 16), method = 'ML')

model_seasonal_i_gdp <- forecast::Arima(gdp_italy_train, order = c(1, 1, 0), seasonal = list(order = c(0, 1, 1), period = 4), method = 'ML')

model_aic_i_gdp <- auto.arima(gdp_italy_train, ic = 'aic')

model_bic_i_gdp <- auto.arima(gdp_italy_train, ic = 'bic')


# Create a list of models
model_list <- list(model_max_i_gdp, model_seasonal_i_gdp, model_aic_i_gdp, model_bic_i_gdp)

# Evaluate the models
evaluate_arima_models(model_list, gdp_italy_test)

```



The ARIMA models we developed correspond to the following characteristics. The first function takes into consideration all the spikes of ACF and PACF and incorporates 9 autoregressive terms and 16 moving average terms, and overall uses the maximum lags. The second model uses seasonality as the main target for the modeling and tells us that it requires differencing for stationarity and for seasonal stationarity. The third uses the parameter the lowest AIC, in this case, 334.4106, and the fourth model the lowest BIC, which was 341.2077. 


```{r plot residual italy gdp, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

plot_residuals_arima <- function(model, country, variable){ 
  
  # Set up the plot
  par(mfrow = c(1, 2), mar = c(3, 4, 4, 1))

  # ACF and PACF plots
  acf(model$residuals, main = paste("ACF of", variable, "residuals in", country))
  pacf(model$residuals, main = paste("PACF of", variable, "residuals in", country))
}



plot_residuals_arima(model_aic_i_gdp, "Italy", "GDP")

```

PRESENTATIONHERE

TODO description and saying best models and no furhter although might be better once (one so small violation okay only95 confidence interval wiht 18 lags 1 or 2 okay)

```{r plot model italy gdp, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
# Plot the forecast
plot_forecast_arima <- function(train_data, test_data, ts_data, country, variable, model) {
  ntest <- length(test_data)
  pred <- forecast(model, h = ntest, level = 0)
  pred_arima <- c(model$fitted, pred$mean)
  
  # Extract the last date of the training data
  last_date_train <- tail(time(train_data), 1)
  
  name <- format_arima_order(model$arma)
  
  ggplot(data.frame(time = time(ts_data), value = ts_data, pred_arima = pred_arima)) + 
    geom_line(aes(x = time, y = value, group = 1)) +
    geom_line(aes(x = time, y = pred_arima, group = 1), color = 'darkgreen', size=0.75) +
    geom_vline(aes(xintercept = as.numeric(last_date_train)), color = "darkblue", size = 0.9) +
    xlab("Year") +
    ylab(paste(variable, "in", country)) +
    labs(title = paste("Forecast for", variable, "in", country),
         subtitle = paste("The best model is", name),
         caption = "Vertical line represents the last date of the training data") +
    theme_minimal() +
    theme(plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
          plot.subtitle = element_text(size = 10, hjust = 0.5),
          plot.caption = element_text(size = 6))
}

plot_forecast_arima(gdp_italy_train, gdp_italy_test, transformed_italy$gdp, "Italy", "GDP", model_bic_i_gdp)

```

PRESENTATIONHERE

As observed in the plot, the forecast we achieved with this model is the most accurate one, and it is by using the ARIMA. The predicted or forecasted plot follows with a very small range of difference from the real line, confirming the model's accuracy.

### 2.2.2 CPI Italy

```{r modelling italy cpi, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# TODO maybe look at seasonal self composed once?

# Creating different models
model_med_i_cpi <- forecast::Arima(cpi_italy_train, order = c(7, 1, 0)) 
model_aic_i_cpi <- auto.arima(cpi_italy_train, ic = 'aic')
model_bic_i_cpi <- auto.arima(cpi_italy_train, ic = 'bic')

model_6_i_cpi <- forecast::Arima(cpi_italy_train, order = c(6, 1, 0))

# Create a list of models
model_list <- list(model_med_i_cpi, model_aic_i_cpi, model_bic_i_cpi)

# Evaluate the models
evaluate_arima_models(model_list, cpi_italy_test)

```

TODO description why which model and evaluation
- first max significant lags 
-Other auto arma with differen IC

```{r plot residual italy cpi, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Plot the residuals of the best model
plot_residuals_arima(model_aic_i_cpi, "Italy", "CPI")

```

TODO Discribe, there are violations so other model maybe GARCH

```{r simplify model italy cpi, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

seasonal_4_6_i_c <- forecast::Arima(cpi_italy_train, order = c(0, 1, 0), seasonal = list(order = c(4, 1, 0), period = 6))

seasonal_4_12_i_c <- forecast::Arima(cpi_italy_train, order = c(0, 1, 0), seasonal = list(order = c(4, 1, 0), period = 12))

seasonal_2_6_i_c <- forecast::Arima(cpi_italy_train, order = c(0, 1, 0), seasonal = list(order = c(2, 1, 0), period = 6))

seasonal_2_12_i_c <- forecast::Arima(cpi_italy_train, order = c(0, 1, 0), seasonal = list(order = c(2, 1, 0), period = 12))

seasonal_1_6_i_c <- forecast::Arima(cpi_italy_train, order = c(0, 1, 0), seasonal = list(order = c(1, 1, 0), period = 6))

model_list <- list(model_aic_i_cpi, seasonal_4_6_i_c, seasonal_4_12_i_c, seasonal_2_6_i_c, seasonal_2_12_i_c, seasonal_1_6_i_c)

# Evauate model
evaluate_arima_models(model_list, cpi_italy_test)


```

TODO discribe
We could se every 6 periods seams to be a season
Also although lowes AIC the MSPE is high so the first would habe been better (or winter holt)

```{r plot residual italy cpi2, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

plot_residuals_arima(seasonal_4_6_i_c, "USA", "CPI")

```

TODO discribe

```{r plot model italy cpi2, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
plot_forecast_arima_3 <- function(train_data, test_data, ts_data, country, variable, wh, arima1, arima2) {
  ntest <- length(test_data)
  
  # Extract the last date of the training data
  last_date_train <- tail(time(train_data), 1)
  
  ggplot(data.frame(time = time(ts_data), value = ts_data, pred_arima = arima1)) + 
    geom_line(aes(x = time, y = value, group = 1, color = "Actual")) +
    
    geom_line(aes(x = time, y = wh, group = 1, color = "WH"), size=0.75) +
    geom_line(aes(x = time, y = arima1, group = 2, color = "ARIMA1"), size=0.75) +
    geom_line(aes(x = time, y = arima2, group = 3, color = "ARIMA2"), size=0.75) +
    
    geom_vline(aes(xintercept = as.numeric(last_date_train)), color = "darkblue", size = 0.9) +
    xlab("Year") +
    ylab(paste(variable, "in", country)) +
    labs(title = paste("Forecast for", variable, "in", country),
         subtitle = paste("The best models"),
         caption = "Vertical line represents the last date of the training data") +
    theme_minimal() +
    theme(plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
          plot.subtitle = element_text(size = 10, hjust = 0.5),
          plot.caption = element_text(size = 6)) +
    scale_color_manual(values = c("Actual" = "black", "WH" = "darkgreen", "ARIMA1" = "orange", "ARIMA2" = "red"))
}



model_hw <- ets(cpi_italy_train, model = 'AAA', alpha = 0.7)
ntest <- length(cpi_italy_test)
pred <- forecast(model_hw, h = ntest, level = 0)
pred_hw <- c(model_hw$fitted, pred$mean)

pred <- forecast(model_aic_i_cpi, h = ntest, level = 0)
pred_arima1 <- c(model_aic_i_cpi$fitted, pred$mean)

pred <- forecast(seasonal_4_6_i_c, h = ntest, level = 0)
pred_arima2 <- c(seasonal_4_6_i_c$fitted, pred$mean)


plot_forecast_arima_3(cpi_italy_train, cpi_italy_test, transformed_italy$cpi, "Italy", "CPI", pred_hw, pred_arima1, pred_arima2)

```


Here several ARIMA models were used alongside winter-holts to capture the trend and seasonality within the CPI data. Although all these models properly model the training data, the test data could not be captured accurately by our modeling. Overall Winter-holt had the best prediction for the direction of the trend.

### 2.2.3 Stocks Italy

```{r residuals garch italy stocks, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
# define a function
returns_evauate <- function(ts_data, country, variable) {
  
  # Set up the plot
  par(mfrow = c(1, 2), mar = c(3, 4, 4, 1))

  # ACF and PACF plots
  acf(ts_data, main = paste("ACF returns of", variable, "in", country))
  pacf(ts_data, main = paste("PACF returns of", variable, "in", country))
}

# log difference
dl_st_i_train <- diff(log(stocks_italy_train))

returns_evauate(dl_st_i_train, "Italy", "Stocks")
```

Because the squared returns, when plotted in ACF and PACF show some violations, it tells sus that there is still information to be  extracted from the data that our previous models did not capture. Therefore GARCH will be used to try and understand the remaining violations of the PACF and ACF.

```{r modelling italy stocks, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

evaluate_garch_models <- function(models) {
  
  results <- data.frame(Model = character(), AIC = numeric(), BIC = numeric(), Residuals = character())
  
  for (i in seq_along(models)) {
    
    model <- models[[i]]
    
    garch_info <- infocriteria(model)

    # Extract AIC and SIC
    aic <-  garch_info[1]
    bic <-  garch_info[2]
    
    # Check residuals for white noise
    white_noise <- Box.test(residuals(model), lag = 20, type = "Ljung-Box")$p.value > 0.05
    residuals_check <- ifelse(white_noise, "White Noise", "Not White Noise")

    # Append results to the data frame
    name <- paste("Model", i)
    result_row <- data.frame(Model = name, AIC = aic, BIC = bic, Residuals = residuals_check)
    results <- rbind(results, result_row)
  }
  
  return(results)
}

a1 <- ugarchfit(ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 0)), distribution.model = "std"), data = stocks_italy_train)
a2 <- ugarchfit(ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(2, 0)), distribution.model = "std"), data = stocks_italy_train)
a3 <- ugarchfit(ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(3, 0)), distribution.model = "std"), data = stocks_italy_train)
a4 <- ugarchfit(ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(4, 0)), distribution.model = "std"), data = stocks_italy_train)
a5 <- ugarchfit(ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(5, 0)), distribution.model = "std"), data = stocks_italy_train)
a6 <- ugarchfit(ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(6, 0)), distribution.model = "std"), data = stocks_italy_train)
a7 <- ugarchfit(ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(7, 0)), distribution.model = "std"), data = stocks_italy_train)

g1 <- ugarchfit(ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(1, 1)), distribution.model = "std"), data = stocks_italy_train)
g2 <- ugarchfit(ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(2, 2)), distribution.model = "std"), data = stocks_italy_train)
g3 <- ugarchfit(ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(3, 3)), distribution.model = "std"), data = stocks_italy_train)

model_list <- list(a1, a2, a3, a4, a5, a6, a7, g1, g2, g3)

evaluate_garch_models(model_list)

```

Here we take into consideration several GARCH models to evaluate them by the lowest AIC, which leads us to use model 8.


```{r modelling garch italy stocks, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

vole <- ts(g1@fit$sigma^2,end=c(2019,10),frequency = 12)
plot(vole,xlab="",ylab="",main="Italy stocks Volatility (GARCH[1,1])")


```

GARCH model was used due to observed volatility in the data, as observed in 2000-2002 the model properly models the dot com bubble, and then in 2007 the housing  crisis 
the model is also consistent with the crisis that also where modeled with the GDP, showing that the stock data of italy is closely related to the country's GDP data 



### 2.2.4 GDP USA

```{r modelling usa gdp, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Creating different models
model_min_u_gdp <- forecast::Arima(gdp_usa_train, order = c(1, 1, 0))
model_drift_u_gdp <- forecast::Arima(gdp_usa_train, order = c(1, 1, 0), include.drift = TRUE)
model_aic_u_gdp <- auto.arima(gdp_usa_train, ic = 'aic')
model_bic_u_gdp <- auto.arima(gdp_usa_train, ic = 'bic')

# Create a list of models
model_list <- list(model_min_u_gdp, model_drift_u_gdp, model_aic_u_gdp, model_bic_u_gdp)

# Evaluate the models
evaluate_arima_models(model_list, gdp_usa_test)
```


Here we take into account several models, the first considers the highest lag within the different data's ACF and PACF to create the model. For the second model we identified that the data was not fully stationary after differencing so we took into account drift to get the data stationary. The last 2 models take into account the lowest aic and bic. 

```{r plot residual usa gdp, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Plot the residuals of the best model
plot_residuals_arima(model_aic_u_gdp, "USA", "GDP")

```

Here the residuals of the data show no violations, therefore our models successfully modeled the test data. No further modeling is needed.

```{r plot model usa gdp, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

plot_forecast_arima(gdp_usa_train, gdp_usa_test, transformed_usa$gdp, "USA", "GDP", model_aic_u_gdp)

```

Our model uses our best forecast, lowest aic model with ARIMA, and  underestimates growth, this can be a result of unpredictable factors such as larger-than-expected growth. 

### 2.2.5 CPI USA

```{r modelling usa cpi, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Creating different models
model_min_u_cpi <- forecast::Arima(cpi_usa_train, order = c(1, 1, 0))

model_aic_u_cpi <- auto.arima(cpi_usa_train, ic = 'aic')
model_bic_u_cpi <- auto.arima(cpi_usa_train, ic = 'bic')

# Create a list of models
model_list <- list(model_min_u_cpi, model_aic_u_cpi, model_bic_u_cpi)

# Evaluate the models
evaluate_arima_models(model_list, cpi_usa_test)

```

Models incorporating drift (ARIMA(2,1,0) and ARIMA(0,1,2)) have lower AIC values, signifying improved fit and suggesting that the inclusion of a linear trend enhances the accuracy in capturing the underlying time series structure.

```{r plot residual usa cpi, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

plot_residuals_arima(model_aic_u_cpi, "USA", "CPI")

```

Because the residuals, when plotted in ACF and PACF show some violations, it tells us that there is still information to be extracted from the data that our previous models did not capture. Therefore other models will be used to try and understand the remaining violations of the PACF and ACF.

```{r simplify model usa cpi, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
simplify_arima <- function(model, data, drift = F, significance_level = 0.05) {
  # Extract coefficients and standard errors
  coefficients <- coef(model)
  cov_matrix <- model$var.coef
  standard_errors <- sqrt(diag(cov_matrix))
  
  # Identify non-significant parameters
  non_significant <- abs(coefficients) < standard_errors * qnorm(1 - significance_level / 2)
  
  # set all values in coefficients to NA
  coefficients <- NA
  coefficients[non_significant] <- 0
  
  # add one NA
  if (drift){
    coefficients <- c(coefficients, NA)}

  # Fit the simplified model
  order <- arimaorder(model)

  simplified_model <- forecast::Arima(data, order = order, fixed = coefficients, include.drift = drift)
  
  return(simplified_model)
}
# Example usage:
max_model <- forecast::Arima(cpi_usa_train, order = c(11, 1, 0))
simplified_model_ar <- simplify_arima(max_model, cpi_usa_train, drift = TRUE)

max_model <- forecast::Arima(cpi_usa_train, order = c(0, 1, 11))
simplified_model_ma <- simplify_arima(max_model, cpi_usa_train, drift = TRUE)

model_list <- list(model_aic_u_cpi, simplified_model_ar, simplified_model_ma)

# Evauate model
evaluate_arima_models(model_list, cpi_usa_test)


```

These new models yield lower AIC results and different values for the other categories and give us better and more accurate overall results. 

```{r plot residual usa cpi2, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

plot_residuals_arima(simplified_model_ma, "USA", "CPI")

```

The newly plotted residuals of ACF and PACF show way fewer violations, and we can safely say the models accurately forecast the data, so we can now choose the desired model. 

```{r plot model usa cpi2, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

plot_forecast_arima(cpi_usa_train, cpi_usa_test, transformed_usa$cpi, "USA", "CPI", simplified_model_ma)

```

After evaluating multiple ARIMA models, the selected one highlights the challenge of accurately predicting future Consumer Price Index (CPI) trends. While the model effectively captures general trends, its limitations in precisely forecasting specific patterns are evident, particularly considering the univariate nature of ARIMA. This is exemplified in the Italy data, where the model indicates a stronger rise in CPI than predicted. 

### 2.2.6 Stocks USA

```{r residuals garch usa stocks, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# log difference
dl_st_i_train <- diff(log(stocks_usa_train))

returns_evauate(dl_st_i_train, "Italy", "Stocks")
```

TODO discribe (for GARCH)

```{r modelling garch usa stocks, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

a1 <- ugarchfit(ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 0)), distribution.model = "std"), data = stocks_usa_train)
a2 <- ugarchfit(ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(2, 0)), distribution.model = "std"), data = stocks_usa_train)
a3 <- ugarchfit(ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(3, 0)), distribution.model = "std"), data = stocks_usa_train)
a4 <- ugarchfit(ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(4, 0)), distribution.model = "std"), data = stocks_usa_train)
a5 <- ugarchfit(ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(5, 0)), distribution.model = "std"), data = stocks_usa_train)
a6 <- ugarchfit(ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(6, 0)), distribution.model = "std"), data = stocks_usa_train)
a7 <- ugarchfit(ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(7, 0)), distribution.model = "std"), data = stocks_usa_train)

g1 <- ugarchfit(ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(1, 1)), distribution.model = "std"), data = stocks_usa_train)
g2 <- ugarchfit(ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(2, 2)), distribution.model = "std"), data = stocks_usa_train)
g3 <- ugarchfit(ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(3, 3)), distribution.model = "std"), data = stocks_usa_train)

model_list <- list(a1, a2, a3, a4, a5, a6, a7, g1, g2, g3)

evaluate_garch_models(model_list)

```

TODO discribe (for GARCH)


```{r graph garch usa stocks, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

vole <- ts(g1@fit$sigma^2,end=c(2019,10),frequency = 12)
plot(vole,xlab="",ylab="",main="USA stocks Volatility (GARCH[1,1])")


```

TODO discribe (for GARCH)


# Conclusion

TODO write


# References

Ardeni, P.G., Gallegati, M. On Italian Economic Development: What the Long-term Says About the Short-term. Ital Econ J (2023). https://doi.org/10.1007/s40797-023-00219-5 

Codogno, L., & Galli, G. (2022). Lessons from Italy’s Economic Decline. https://economy2030.resolutionfoundation.org/wp-content/uploads/2022/11/Lessons-from-Italys-economic-decline_.pdf

Salvatore, D. (2020). Growth and trade in the United States and the World Economy: Overview. Journal of policy modeling. https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7195104/  

Limam Ould Mohamed Mahmoud, 2015. "Consumer Price Index and Economic Growth: A Case Study of Mauritania 1990 – 2013," Asian Journal of Empirical Research, Asian Economic and Social Society, vol. 5(2), pages 16-23. 
